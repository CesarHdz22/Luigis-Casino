<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bomberman 2 Jugadores</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #111;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        h1 {
            margin-bottom: 5px;
        }

        #info {
            font-size: 14px;
            margin-bottom: 10px;
            text-align: center;
        }

        #game {
            display: grid;
            grid-template-columns: repeat(13, 40px);
            grid-template-rows: repeat(11, 40px);
            gap: 0;
            border: 4px solid #555;
            background: #222;
        }

        .cell {
            width: 40px;
            height: 40px;
        }

        .wall {
            background: #555;
            border: 2px solid #333;
        }

        .crate {
            background: #a86b32;
            border: 2px solid #784722;
        }

        .bomb {
            background: radial-gradient(circle, #fff 0%, #444 40%, #000 70%);
            border-radius: 50%;
            border: 2px solid #000;
        }

        .explosion {
            background: radial-gradient(circle, #fff9c4 0%, #ff9800 40%, #f44336 80%);
        }

        .player1 {
            background: #2196f3;
            border-radius: 50%;
            border: 2px solid #0d47a1;
        }

        .player2 {
            background: #e91e63;
            border-radius: 50%;
            border: 2px solid #880e4f;
        }

        #overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #fff;
            font-size: 28px;
            text-align: center;
        }

        #overlay small {
            font-size: 16px;
            margin-top: 10px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
<h1>Bomberman 2 Jugadores</h1>
<div id="info">
    Jugador 1: <b>WASD</b> + <b>Space</b> (bomba) &nbsp;|&nbsp;
    Jugador 2: <b>Flechas</b> + <b>Enter</b> (bomba) &nbsp;|&nbsp;
    <b>R</b> para reiniciar
</div>
<div id="game"></div>

<div id="overlay">
    <div id="message"></div>
    <small>Presiona R para reiniciar</small>
</div>

<script>
(function () {
    const ROWS = 11;
    const COLS = 13;
    const BOMB_DELAY = 2000;       // ms antes de explotar
    const EXPLOSION_DURATION = 500; // ms que dura la explosión
    const RANGE = 2;               // alcance de la explosión

    const gameEl = document.getElementById('game');
    const overlayEl = document.getElementById('overlay');
    const messageEl = document.getElementById('message');

    let cells = [];
    let grid = []; // 'empty', 'wall', 'crate', 'bomb', 'explosion'
    let bombs = [];
    let gameOver = false;

    const player1 = {row: 1, col: 1, alive: true};
    const player2 = {row: ROWS - 2, col: COLS - 2, alive: true};

    function createBoard() {
        gameEl.innerHTML = '';
        cells = [];
        for (let r = 0; r < ROWS; r++) {
            const rowCells = [];
            for (let c = 0; c < COLS; c++) {
                const div = document.createElement('div');
                div.classList.add('cell');
                gameEl.appendChild(div);
                rowCells.push(div);
            }
            cells.push(rowCells);
        }
    }

    function initGrid() {
        grid = [];
        for (let r = 0; r < ROWS; r++) {
            const row = [];
            for (let c = 0; c < COLS; c++) {
                let value = 'empty';

                // bordes de muro
                if (r === 0 || c === 0 || r === ROWS - 1 || c === COLS - 1) {
                    value = 'wall';
                } else if (r % 2 === 0 && c % 2 === 0) {
                    // muros internos fijos
                    value = 'wall';
                } else {
                    // posible caja
                    const nearP1 = (Math.abs(r - 1) + Math.abs(c - 1)) <= 2;
                    const nearP2 = (Math.abs(r - (ROWS - 2)) + Math.abs(c - (COLS - 2))) <= 2;
                    if (!nearP1 && !nearP2 && Math.random() < 0.3) {
                        value = 'crate';
                    }
                }

                row.push(value);
            }
            grid.push(row);
        }

        // posiciones iniciales
        player1.row = 1; player1.col = 1; player1.alive = true;
        player2.row = ROWS - 2; player2.col = COLS - 2; player2.alive = true;
        bombs = [];
        gameOver = false;
        overlayEl.style.display = 'none';
    }

    function clearCellClasses(r, c) {
        const cell = cells[r][c];
        cell.className = 'cell';
    }

    function renderCell(r, c) {
        clearCellClasses(r, c);
        const type = grid[r][c];
        if (type === 'wall') cells[r][c].classList.add('wall');
        else if (type === 'crate') cells[r][c].classList.add('crate');
        else if (type === 'bomb') cells[r][c].classList.add('bomb');
        else if (type === 'explosion') cells[r][c].classList.add('explosion');

        if (player1.alive && player1.row === r && player1.col === c) {
            cells[r][c].classList.add('player1');
        }
        if (player2.alive && player2.row === r && player2.col === c) {
            cells[r][c].classList.add('player2');
        }
    }

    function renderAll() {
        for (let r = 0; r < ROWS; r++) {
            for (let c = 0; c < COLS; c++) {
                renderCell(r, c);
            }
        }
    }

    function isWalkable(r, c) {
        if (r < 0 || c < 0 || r >= ROWS || c >= COLS) return false;
        const type = grid[r][c];
        return type === 'empty' || type === 'explosion';
    }

    function movePlayer(player, dr, dc) {
        if (!player.alive || gameOver) return;
        const nr = player.row + dr;
        const nc = player.col + dc;
        if (!isWalkable(nr, nc)) return;

        const oldR = player.row;
        const oldC = player.col;
        player.row = nr;
        player.col = nc;
        renderCell(oldR, oldC);
        renderCell(nr, nc);
    }

    function placeBomb(player, ownerId) {
        if (!player.alive || gameOver) return;
        const r = player.row;
        const c = player.col;
        if (grid[r][c] === 'bomb') return; // ya hay una bomba aquí
        if (grid[r][c] === 'wall') return;

        grid[r][c] = 'bomb';
        renderCell(r, c);

        const bombId = setTimeout(() => {
            explodeBomb(r, c, ownerId);
        }, BOMB_DELAY);

        bombs.push({r, c, ownerId, bombId});
    }

    function explodeBomb(r, c, ownerId) {
        // puede haberse limpiado al reiniciar
        if (grid[r][c] !== 'bomb' && grid[r][c] !== 'empty') {
            // seguimos igual; igual explotamos en esa casilla
        }

        const explosionCells = [];

        function addExplosionCell(rr, cc) {
            if (rr < 0 || cc < 0 || rr >= ROWS || cc >= COLS) return false;
            if (grid[rr][cc] === 'wall') {
                return false; // muro indestructible detiene
            }
            if (grid[rr][cc] === 'crate') {
                grid[rr][cc] = 'explosion';
                explosionCells.push({r: rr, c: cc});
                checkPlayerHit(rr, cc);
                return false; // destruye caja y se detiene
            }

            grid[rr][cc] = 'explosion';
            explosionCells.push({r: rr, c: cc});
            checkPlayerHit(rr, cc);
            return true; // sigue propagando
        }

        // centro
        addExplosionCell(r, c);

        // arriba
        for (let i = 1; i <= RANGE; i++) {
            if (!addExplosionCell(r - i, c)) break;
        }
        // abajo
        for (let i = 1; i <= RANGE; i++) {
            if (!addExplosionCell(r + i, c)) break;
        }
        // izquierda
        for (let i = 1; i <= RANGE; i++) {
            if (!addExplosionCell(r, c - i)) break;
        }
        // derecha
        for (let i = 1; i <= RANGE; i++) {
            if (!addExplosionCell(r, c + i)) break;
        }

        renderAll();

        setTimeout(() => {
            explosionCells.forEach(pos => {
                if (grid[pos.r][pos.c] === 'explosion') {
                    grid[pos.r][pos.c] = 'empty';
                }
            });
            renderAll();
        }, EXPLOSION_DURATION);
    }

    function checkPlayerHit(r, c) {
        if (player1.alive && player1.row === r && player1.col === c) {
            player1.alive = false;
            renderCell(r, c);
            endGame('¡Jugador 2 gana!');
        }
        if (player2.alive && player2.row === r && player2.col === c) {
            player2.alive = false;
            renderCell(r, c);
            endGame('¡Jugador 1 gana!');
        }
        if (!player1.alive && !player2.alive && !gameOver) {
            endGame('¡Empate!');
        }
    }

    function endGame(text) {
        gameOver = true;
        messageEl.textContent = text;
        overlayEl.style.display = 'flex';
    }

    function initGame() {
        createBoard();
        initGrid();
        renderAll();
    }

    // Controles
    window.addEventListener('keydown', (e) => {
        const codesHandled = new Set([
            'KeyW','KeyA','KeyS','KeyD',
            'ArrowUp','ArrowDown','ArrowLeft','ArrowRight',
            'Space','Enter','KeyR'
        ]);
        if (codesHandled.has(e.code)) {
            e.preventDefault();
        }

        if (e.code === 'KeyR') {
            // reiniciar página completa
            location.reload();
            return;
        }

        if (gameOver) return;

        switch (e.code) {
            // Jugador 1
            case 'KeyW': movePlayer(player1, -1, 0); break;
            case 'KeyS': movePlayer(player1, 1, 0); break;
            case 'KeyA': movePlayer(player1, 0, -1); break;
            case 'KeyD': movePlayer(player1, 0, 1); break;
            case 'Space': placeBomb(player1, 1); break;

            // Jugador 2
            case 'ArrowUp': movePlayer(player2, -1, 0); break;
            case 'ArrowDown': movePlayer(player2, 1, 0); break;
            case 'ArrowLeft': movePlayer(player2, 0, -1); break;
            case 'ArrowRight': movePlayer(player2, 0, 1); break;
            case 'Enter': placeBomb(player2, 2); break;
        }
    });

    // Iniciar
    initGame();
})();
</script>
</body>
</html>
